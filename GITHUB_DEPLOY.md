# Инструкция по деплою на GitHub Pages

Подробная инструкция по развертыванию дашборда на GitHub Pages без использования GitHub Actions.

## Предварительные требования

1. **Git установлен** на вашем компьютере
2. **Node.js и npm установлены** (для gh-pages)
3. **GitHub аккаунт** и репозиторий создан

## Шаг 1: Подготовка репозитория

### 1.1. Инициализация Git (если еще не сделано)

```bash
# Инициализация git репозитория
git init

# Добавление всех файлов
git add .

# Первый коммит
git commit -m "Initial commit"
```

### 1.2. Подключение к GitHub

```bash
# Добавление remote
git remote add origin https://github.com/bogachev11/french-challenge.git

# Переименование ветки в main (если нужно)
git branch -M main

# Отправка кода на GitHub
git push -u origin main
```

## Шаг 2: Установка gh-pages

```bash
# Установка gh-pages как dev-зависимости
npm install --save-dev gh-pages
```

Или если используете yarn:

```bash
yarn add -D gh-pages
```

## Шаг 3: Настройка package.json

### 3.1. Добавьте поле `homepage`

Откройте `package.json` и добавьте поле `homepage` с URL вашего GitHub Pages:

```json
{
  "name": "french-challenge",
  "version": "1.0.0",
  "homepage": "https://bogachev11.github.io/french-challenge",
  "scripts": {
    "deploy": "gh-pages -d ."
  }
}
```

**Важно:** 
- Username: `bogachev11`
- Репозиторий: `french-challenge`
- URL: `https://bogachev11.github.io/french-challenge`

### 3.2. Проверьте скрипт deploy

Убедитесь, что в `package.json` есть скрипт:

```json
{
  "scripts": {
    "deploy": "gh-pages -d ."
  }
}
```

**Примечание:** `-d .` означает, что деплоится текущая директория. Если ваши файлы в подпапке (например, `dist/`), укажите путь: `gh-pages -d dist`

## Шаг 4: Настройка GitHub Pages в репозитории

1. Откройте ваш репозиторий на GitHub
2. Перейдите в **Settings** (Настройки)
3. В левом меню найдите раздел **Pages**
4. В разделе **Source** выберите:
   - **Branch:** `gh-pages`
   - **Folder:** `/ (root)`
5. Нажмите **Save**

**Важно:** Не выбирайте "GitHub Actions" - мы используем прямой деплой через gh-pages.

## Шаг 5: Первый деплой

### 5.1. Убедитесь, что все изменения закоммичены

```bash
# Проверка статуса
git status

# Если есть незакоммиченные изменения, добавьте их
git add .
git commit -m "Prepare for deployment"
git push origin main
```

### 5.2. Запустите деплой

```bash
npm run deploy
```

Эта команда:
1. Создаст ветку `gh-pages` (если её нет)
2. Скопирует все файлы из текущей директории в эту ветку
3. Отправит изменения на GitHub

### 5.3. Проверка деплоя

После выполнения команды:
1. Подождите 1-2 минуты (GitHub Pages обновляется не мгновенно)
2. Откройте URL: `https://bogachev11.github.io/french-challenge`
3. Проверьте, что дашборд загружается корректно

## Шаг 6: Последующие обновления

После каждого изменения кода:

```bash
# 1. Закоммитьте изменения в main ветку
git add .
git commit -m "Описание изменений"
git push origin main

# 2. Задеплойте на GitHub Pages
npm run deploy
```

**Важно:** 
- Всегда сначала пушите изменения в `main`
- Затем запускайте `npm run deploy`
- `gh-pages` создает отдельную ветку, ваши исходники остаются в `main`

## Шаг 7: Работа с API ключами и секретами

### 7.1. Если используете API ключи в коде

**НЕ храните API ключи в коде!** Используйте один из вариантов:

#### Вариант 1: Переменные окружения (рекомендуется)

1. Создайте файл `.env` (уже должен быть в `.gitignore`):
```
GOOGLE_SHEETS_API_KEY=ваш_ключ
GOOGLE_SHEETS_ID=ваш_id
```

2. В `app.js` используйте:
```javascript
const API_KEY = window.API_TOKEN || 'ваш_публичный_ключ';
```

3. Для GitHub Pages можно:
   - Использовать публичный API ключ (если он ограничен по домену)
   - Или использовать GitHub Secrets через Actions (но это не входит в эту инструкцию)

#### Вариант 2: Публичный API ключ с ограничениями

Если API ключ ограничен по домену, добавьте в настройках Google Cloud:
- `https://bogachev11.github.io`
- `https://french-challenge.github.io`

### 7.2. Проверка путей к файлам

Убедитесь, что все пути к файлам относительные:

✅ **Правильно:**
```html
<link rel="stylesheet" href="styles.css">
<script src="app.js"></script>
```

❌ **Неправильно:**
```html
<link rel="stylesheet" href="/styles.css">
<script src="/app.js"></script>
```

## Шаг 8: Проверка работоспособности

### 8.1. Локальная проверка перед деплоем

```bash
# Запустите локальный сервер
npm start
# или
python -m http.server 3000

# Откройте http://localhost:3000
# Проверьте, что все работает
```

### 8.2. Проверка после деплоя

1. **Откройте консоль браузера** (F12) на странице GitHub Pages
2. Проверьте наличие ошибок:
   - 404 для файлов (неправильные пути)
   - CORS ошибки (проблемы с API)
   - Ошибки загрузки библиотек (React, Recharts)

### 8.3. Типичные проблемы

| Проблема | Решение |
|----------|---------|
| Страница не загружается | Проверьте URL в `package.json` (homepage) |
| Файлы не найдены (404) | Используйте относительные пути, проверьте что файлы в корне |
| Графики не отображаются | Проверьте загрузку `recharts.js`, откройте консоль браузера |
| API не работает | Проверьте API ключ, ограничения по домену, CORS |
| Стили не применяются | Проверьте путь к `styles.css`, версию в `?v=21` |

## Шаг 9: Настройка кастомного домена (опционально)

Если хотите использовать свой домен:

1. Создайте файл `CNAME` в корне проекта:
```
yourdomain.com
```

2. Добавьте `CNAME` в репозиторий:
```bash
git add CNAME
git commit -m "Add custom domain"
git push origin main
npm run deploy
```

3. Настройте DNS записи у вашего провайдера:
   - Тип: `CNAME`
   - Имя: `www` (или `@`)
   - Значение: `bogachev11.github.io`

4. В настройках GitHub Pages добавьте домен

## Структура веток после деплоя

После первого деплоя у вас будет:

- **`main`** - исходный код проекта (ваша рабочая ветка)
- **`gh-pages`** - автоматически созданная ветка с файлами для GitHub Pages

**Не редактируйте `gh-pages` вручную!** Всегда используйте `npm run deploy`.

## Полезные команды

```bash
# Проверка установленных пакетов
npm list gh-pages

# Просмотр веток
git branch -a

# Просмотр последних коммитов в gh-pages
git log gh-pages --oneline -5

# Удаление ветки gh-pages (если нужно начать заново)
git branch -D gh-pages
git push origin --delete gh-pages
```

## Чеклист перед деплоем

- [ ] Все изменения закоммичены в `main`
- [ ] `package.json` содержит правильный `homepage`
- [ ] Установлен `gh-pages` (`npm install --save-dev gh-pages`)
- [ ] В `package.json` есть скрипт `"deploy": "gh-pages -d ."`
- [ ] В GitHub репозитории настроен Pages (ветка `gh-pages`)
- [ ] Все пути к файлам относительные
- [ ] API ключи настроены (если используются)
- [ ] Локально все работает (`npm start`)

## Поддержка

Если что-то не работает:

1. Проверьте консоль браузера (F12)
2. Проверьте логи деплоя в терминале
3. Убедитесь, что прошло достаточно времени (GitHub Pages обновляется с задержкой)
4. Проверьте настройки репозитория → Pages

---

**Готово!** Ваш дашборд должен быть доступен по адресу:
`https://bogachev11.github.io/french-challenge`

